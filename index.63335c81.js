const t=new class{constructor(t=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]){if(4===t.length&&t.every(t=>4===t.length))this.initialState=t,this.restart();else throw Error("Initial state is not valid!")}moveLeft(){if("playing"===this.status){let t=this.state.map(t=>this.merge(t,0));this.handleMove(t)}}moveRight(){if("playing"===this.status){let t=this.state.map(t=>this.merge(t,1));this.handleMove(t)}}moveUp(){if("playing"===this.status){let t=this.rotateMatrix(this.state,1).map(t=>this.merge(t,1)),e=this.rotateMatrix(t,0);this.handleMove(e)}}moveDown(){if("playing"===this.status){let t=this.rotateMatrix(this.state,1).map(t=>this.merge(t,0)),e=this.rotateMatrix(t,0);this.handleMove(e)}}handleMove(t){this.isStateDifferent(t)&&(this.state=t,this.firstMoveMade=!0,this.putNewNumber(),this.isGameOver()?this.status="lose":this.isGameWon()&&(this.status="win"))}getScore(){return this.score}getState(){return this.state}getStatus(){return this.status}start(){this.restart(),this.status="playing",this.putNewNumber(),this.putNewNumber()}restart(){this.state=this.cloneState(this.initialState),this.score=0,this.status="idle",this.firstMoveMade=!1}cloneState(t){return t.map(t=>[...t])}isStateDifferent(t){return JSON.stringify(this.state)!==JSON.stringify(t)}getFirstMoveMade(){return this.firstMoveMade}getAvailableCell(){let t=[];return this.state.forEach((e,s)=>{e.forEach((e,i)=>{e||t.push({x:i,y:s})})}),t}generateNumber(){return .9>Math.random()?2:4}putNewNumber(){let t=this.getAvailableCell();if(t.length>0){let{x:e,y:s}=t[Math.floor(Math.random()*t.length)];this.state[s][e]=this.generateNumber()}}isGameOver(){return 0===this.getAvailableCell().length&&[()=>this.testMove(this.moveLeft.bind(this)),()=>this.testMove(this.moveRight.bind(this)),()=>this.testMove(this.moveUp.bind(this)),()=>this.testMove(this.moveDown.bind(this))].every(t=>!t())}testMove(t){let e=this.cloneState(this.state);t();let s=this.isStateDifferent(e);return this.state=e,s}isGameWon(){return this.state.some(t=>t.some(t=>2048===t))}rotateMatrix(t,e){let s=t.length,i=Array.from({length:s},()=>Array(s).fill(0));if(e)for(let e=0;e<s;e++)for(let r=0;r<s;r++)i[r][s-1-e]=t[e][r];else for(let e=0;e<s;e++)for(let r=0;r<s;r++)i[s-1-r][e]=t[e][r];return i}merge(t,e){let s=e?[...t].reverse():[...t],i=[],r=0,a=s.filter(t=>0!==t);for(let t=0;t<a.length;t++)a[t]===a[t+1]?(i.push(2*a[t]),r+=2*a[t],t++):i.push(a[t]);for(;i.length<t.length;)i.push(0);return this.score+=r,e?i.reverse():i}};function e(){var e,i;e=t.getState(),document.querySelectorAll(".field-row").forEach((t,s)=>{e[s].forEach((e,s)=>{let i=t.children[s];i.className=`field-cell field-cell--${e}`,i.innerText=e>0?e:"",e>0&&(i.classList.add("merge"),setTimeout(()=>i.classList.remove("merge"),600))})}),i=t.getScore(),document.querySelector(".game-score").innerText=i,t.getFirstMoveMade()?(s.className="button restart",s.innerText="Restart"):(s.className="button start",s.innerText="Start"),function(t){document.querySelectorAll(".message").forEach(t=>{t.classList.add("hidden")});let e={idle:"message-start",win:"message-win",lose:"message-lose"}[t];e&&document.querySelector(`.${e}`).classList.remove("hidden")}(t.getStatus())}const s=document.querySelector(".button");s.addEventListener("click",()=>{switch(s.innerText){case"Start":t.start();break;case"Restart":t.restart()}e()}),document.addEventListener("keydown",s=>{let i={ArrowUp:()=>t.moveUp(),ArrowRight:()=>t.moveRight(),ArrowDown:()=>t.moveDown(),ArrowLeft:()=>t.moveLeft()}[s.key];i&&(s.preventDefault(),i()),e()});
//# sourceMappingURL=index.63335c81.js.map
